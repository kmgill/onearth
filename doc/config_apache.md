# Apache Configuration

The following sections outline the configuration updates that are required in order to serve imagery through the OnEarth apache module.  Configuration changes may be made directly in the `/etc/httpd/conf/conf.d` file or in a `/etc/httpd/conf.d/<config.d>` file.  The latter requires that Apache be configured to read configuration files in the `conf.d` directory.

## OnEarth Modules
The OnEarth utility installs two Apache modules into the apache `<lib dir>/httpd/modules/` directory.  Apache must be configured to include these modules.  To do so, the following lines must be added to the apache configuration file.

```bash
LoadModule onearth_module modules/mod_onearth.so
LoadModule twms_module modules/mod_twms.so
```

## OnEarth Endpoint Directories
A '<Directory>' element must be included in the Apache configuration for each OnEarth imagery service endpoint.  A sample configuration element is shown below.  Note the following items of interest:

* **OptionsIndexes** - The _FollowSymLinks_ option allows for an endpoint to be configured using symlinks for simpler configuration management.  The _ExecCGI_ option is required to execute the WMTS and TWMS CGI script.
* **WMSCache** - This custom element points to the WMTS or TWMS cache configuration file that is generated by the OnEarth layer configuration tool.
* **Rewrite** - The suggested configuration rewrites '.jpg' to '.jpeg' to optimize URL matching internal to the OnEarth module.

Sample WMTS endpoint
```Shell
<Directory "/usr/share/onearth/demo/wmts-geo">
    Options Indexes FollowSymLinks +ExecCGI
    AddHandler cgi-script .cgi
    AllowOverride None
    Order allow,deny
    Allow from all
    WMSCache        /usr/share/onearth/demo/data/EPSG4326/cache_wmts.config

    Header set Access-Control-Allow-Origin *

</Directory>
```

Sample Tiled-WMS endpoint
```Shell
<Directory "/usr/share/onearth/demo/twms-geo">
    Options Indexes FollowSymLinks ExecCGI
    AddHandler cgi-script .cgi
    AllowOverride None
    Order allow,deny
    Allow from all
    wmsCache /usr/share/onearth/demo/data/EPSG4326/cache.config
    TWMSDirConfig .lib/getTileService.xml
</Directory>
```

A new endpoint must be create for each projection.  For instance, if Web Mercator projected imagery is also desired as a WMTS endpoint:
```Shell
<Directory "/usr/share/onearth/demo/wmts-webmerc">
    Options Indexes FollowSymLinks +ExecCGI
    AddHandler cgi-script .cgi
    AllowOverride None
    Order allow,deny
    Allow from all
    WMSCache        /usr/share/onearth/demo/data/EPSG3857/cache_wmts.config

    Header set Access-Control-Allow-Origin *

</Directory>
```

**KML** - Note that the KML service requires the existence of a Tiled-WMS endpoint.

To configure an endpoint on the file system:
* [Configure Endpoint](config_endpoint.md)
